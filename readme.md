This Example is for dialog webhook to service directory proxy

Assumptions:    Google Project Name: prj-example-1
                (to change the google project you simply need to update the first line of the scipts in steps 2-6  listed below)\



******************                                      | *********  vpc-eng-1 ***************
* Dialog Flow CX *  ----------Via Service Directory ----|--->NodePort->Kubernetes Service (NGINX) -> API
*                *  ----------Via Service Directory ----|--->Pod ->Kubernetes Pod (NGINX) -> API
*                *  ----------Via Service Direttory ----|--->Service -> Kubernetes Service (NGINX) ->API # NO WORK
*                *  ----------Via Service Directory ----|--->Load-Balancer -> Proxy only Subnet -> Internal Load Balancer -> Kubernetes POD API (NEGS)   #NO work 
*                *                                      **************************************
******************

FYI....    The Service and Load Balancer DO WORK when you test them using direct methods from a vm within the vpc.
FYI....    ALL FIREWALL RULES ARE CREATED






To Setup:  (assuming macos with gcloud/docker)

1.   Change folder to recipe
2.   Run ./1_createProject.sh
3.   Run ./2_buildCertsAndImages.sh
4.   Run ./3_CreateVPC.sh
5.   Run ./4_buildClusterAndConfigure.sh
6.   Run ./5_LoadBalancerConfig.sh

MANUAL STEPS


export NetProject=prj-example-1
gcloud config set project $NetProject

kubectl get pods -o yaml 
#####get podip for df-bridge and run these command
export NetProjectID=$(gcloud projects list | grep $NetProject | awk '{print $NF}')
gcloud service-directory endpoints update pod-direct --location=us-east1 --namespace=df-example --service=pod-direct   --address=10.20.1.6 --port=443

kubectl get services -o yaml 
gcloud service-directory endpoints update svc-direct --location=us-east1 --namespace=df-example --service=svc-direct   --address=10.30.0.229 --port=443

Sign into Dialog Flow CX Console.    
Enable Project / Billing
Create New Dialog Flow Agent "Example1"
Restore from file: exported_agent_example1.blob 

Configuration of Dialog Flow WebHook:
Change certificates in the webhooks (all 4 of them) with the der files found in recipe generated by step2
- myCert.der
- CAPrivate.der

There are 4 tests:

Ping Node - Works
Ping Pod - Works
Ping Service - DOES NOT WORK????     Even though it should
Ping Load Balancer - DOES Not Work????    Even though it should


# df-webhook-example
